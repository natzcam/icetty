#!/usr/bin/env node

const argv = require("yargs").argv;
const inquirer = require("inquirer")
const os = require("os")
const debug = require("debug")("icetty:service-installer");
const host = require("../lib/host");

(async () => {
  await host.cleanup()
  const platform = os.platform()

  let svc
  if (platform === "win32") {

    svc = new require("node-windows").Service({
      name: "icettyd",
      description: "p2p command line daemon",
      script: require("path").join(__dirname, "icettyd"),
      env: {
        name: "DEBUG",
        value: "icetty:*"
      }
    });

  } else if (platform == "darwin") {

    svc = new require("node-mac").Service({
      name: "icettyd",
      description: "p2p command line daemon",
      script: require("path").join(__dirname, "icettyd"),
      env: {
        name: "DEBUG",
        value: "icetty:*"
      }
    });

  } else if (platform == "linux") {

    const Service = require("node-linux").Service;
    svc = new Service({
      name: "icettyd",
      description: "p2p command line daemon",
      script: require("path").join(__dirname, "icettyd"),
      env: {
        name: "DEBUG",
        value: "icetty:*"
      }
    });

  } else {
    throw new Error('Platform not supported')
  }

  svc.on("uninstall", function () {
    console.log("Uninstall complete");
  });

  svc.uninstall();
})();
